# 🦖 인프런 운영체제 공룡책 강의

## Section 5

### 프로세스 동기화

- Race Condition(경쟁 상황)
  - 두 개 이상의 프로세스 또는 스레드가 공유하고 있는 데이터를 동시에 접근, 조작하면서 순서에 따라 데이터가 달라지는 현상
  - 해결 방법 
    - 동일한 시간에 하나의 프로세스 또는 스레드의 접근을 허용 (synchronization)
- 임계 영역 문제
  - N 개의 프로세스가 존재하는 시스템이 있을 때, 여러 프로세스들이 접근 또는 수정하는 영역을 임계영역으로 설정하자
  - 임계영역에는 최대 1개만 접근할 수 있도록 제한하자
  - 코드의 영역
    - entry-section : 임계영역 진입을 위한 허용을 요청
    - critical-section : 임계영역 진입
    - exit-section : 임계영역 사용 완료
    - remainder-section : 임계영역 바깥에 있는 코드 구역
  - 임계 영역 문제를 해결하기 위한 요구사항
    - `Mutual Exclusion (상호배제)`
    - Progress (데드락을 피해야 한다.)
      - 임계 영역에 진입할 수 없어 무한정 대기하는 발생하는 것을 피해야 한다.
    - Bounded Waiting (기아현상을 피해야 한다.)
      - 대기 시간을 한정시켜 오랜시간 대기하는 작업을 처리하여 기아현상을 방지해야 한다.

### Peterson's Algorithm
- 두 개의 프로세스가 존재하는 환경에서 임계 영역 접근을 제한하는 방식
  - critical section 과 remainder section 사이를 오고가며 접근을 제한
  - boolean flag[2] : 현재 임계 영역을 사용중인 프로세스를 알린다. 
  - turn 변수 : 다음 차례를 알린다.
  ```java
      int turn;
      boolean flag[2];
      while(true){ // 무한루프 돌기
        flag[i]= true;  // 이제 내가 사용할 거야 
        turn = j; // 다음 차례는 상대편이야
        while(flag[j] && turn == j); // entry section (상대편 차례이면서, 사용중일때는 루프돌면서 대기)
       
           // 임계영역  
       
        flag[i] = false; // 나는 임계영역에서의 작업이 끝났어
       
            // remainder section 
      }
  ```
  - 위와 같은 코드로 작성해도 동기화가 완벽히 이뤄지지 않는다.
    - flag와 turn을 조작,접근하는 과정에서 context switching 이 발생하면서 문제가 발생한다.
  - 하지만 피터슨 알고리즘은 이론,개념적으로 mutual exclusion, progress, bounded waiting 조건을 다 지킬 수 있다.

### 원자성
- Atomicity
  - uninterruptible unit of operation
  - 인터럽트를 걸 수 없는 작업의 성질
  - 하드웨어 측면에서 임계 영역 문제를 원자성 성질을 이용해 해결하기
    - 레지스터에 값을 저장하고, 레지스터에 저장한 값을 조작한 뒤 다시 전역 변수에 변화된 레지스터 값을 넣는 과정을 하나의 작업 단위로 만들어 내기 
    - 컨텍스트 스위칭, swap 과정을 하나의 작업 단위로 만들어내기
